# Reference HTML Structure Analysis

This document analyzes the HTML structure generated by the TypeScript chatgpt-exporter to guide Python implementation.

## Sample Reference File

Analyzed file: `ChatGPT-Freezing_Rye_Bread.html` (836 lines)

## DOCTYPE and HTML Tag

```html
<!DOCTYPE html>
<html lang="en-US" data-theme="dark">
```

**Key observations:**

- Standard HTML5 DOCTYPE
- `lang="en-US"` attribute on html tag
- `data-theme="dark"` attribute for theme switching (toggleable between dark/light)

## Head Section Structure

### Meta Tags and Title

```html
<head>
    <meta charset="UTF-8" />
    <link rel="icon" href="https://chat.openai.com/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Freezing Rye Bread</title>
```

**Key observations:**

- UTF-8 charset
- OpenAI favicon link
- Viewport meta tag for responsive design
- Title is the conversation title (not prefixed with "ChatGPT-")

### External Dependencies

```html
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll()
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.3/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.3/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.3/contrib/auto-render.min.js"></script>
```

**Key observations:**

- Highlight.js for code syntax highlighting (github-dark theme)
- KaTeX for math rendering
- Both loaded from CDN

### JavaScript for KaTeX

Extensive JavaScript configuration for math rendering:

- Supports multiple delimiters: `$$...$$`, `$...$`, `\[...\]`, `\(...\)`
- Auto-renders on `DOMContentLoaded`
- Centers display math, inline rendering for inline math
- Custom preprocessing: `\displaystyle \Large` applied to math
- Special handling to detect if KaTeX is the only content in a paragraph

### CSS Variables and Theming

```css
:root {
    --page-text: #0d0d0d;
    --page-bg: #fff;
    --td-borders: #374151;
    --th-borders: #4b5563;
    --tw-prose-code: var(--page-text);
    --tw-prose-counters: #9b9b9b;
    --tw-prose-headings: var(--page-text);
    --tw-prose-hr: rgba(0,0,0,.25);
    --tw-prose-links: var(--page-text);
    --tw-prose-quotes: var(--page-text);
    --meta-title: #616c77;
}

[data-theme="dark"] {
    --page-text: #ececec;
    --page-bg: #212121;
    /* ... dark mode overrides ... */
}
```

**Key observations:**

- CSS custom properties for theming
- Light theme in `:root`
- Dark theme overrides in `[data-theme="dark"]` selector
- Consistent naming pattern (--tw-prose-* follows Tailwind convention)

### Typography and Base Styles

```css
* {
    box-sizing: border-box;
    font-size: 16px;
}

body {
    font-family: SÃ¶hne,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
    font-size: 14px;
    line-height: 1.5;
    color: var(--page-text);
    background-color: var(--page-bg);
    margin: 0;
    padding: 0;
}
```

**Key observations:**

- Universal box-sizing: border-box
- Base font size: 16px on all elements, 14px on body
- OpenAI's custom font "SÃ¶hne" with extensive fallback stack
- Uses CSS custom properties for colors

### Scrollbar Styling

Extensive webkit scrollbar customization:

- Custom width/height
- Rounded corners
- Theme-aware colors
- Hover effects
- Hidden on desktop until hover (`.scrollbar-trigger`)

### Code and Pre Styling

```css
p>code, li>code {
    color: var(--tw-prose-code);
    font-weight: 600;
    font-size: .875em;
}

p>code::before,
p>code::after,
li>code::before,
li>code::after {
    content: "`";
}

pre {
    color: #ffffff;
    background-color: #000000;
    overflow-x: auto;
    margin: 0 0 1rem 0;
    border-radius: 0.375rem;
}

pre>code {
    font-family: SÃ¶hne Mono, Monaco, Andale Mono, Ubuntu Mono, monospace !important;
    font-weight: 400;
    font-size: .875em;
    line-height: 1.7142857;
}
```

**Key observations:**

- Inline code gets backticks via CSS pseudo-elements
- Pre blocks: black background, white text, rounded corners
- Monospace font stack for code
- Horizontal scroll for long code lines

### Heading Styles

```css
h1 {
    font-size: 2.25em;
    font-weight: 600;
    line-height: 1.1111111;
    margin-bottom: 0.8888889em;
    margin-top: 0;
}

h2 {
    font-size: 1.5em;
    font-weight: 700;
    line-height: 1.3333333;
    margin-bottom: 1em;
    margin-top: 2em;
}

h3 {
    font-size: 1.25em;
    font-weight: 600;
    line-height: 1.6;
    margin-bottom: .6em;
    margin-top: 1.6em;
}
```

**Key observations:**

- Precise em-based sizing and spacing
- Different font weights for different levels
- Carefully tuned line heights and margins

### Other Notable CSS

- **Blockquotes**: Left border, italic, with smart quotes via CSS content
- **Lists**: Modest left padding (1.1rem), custom marker colors
- **Tables**: Separate border model, rounded corners, theme-aware borders
- **Horizontal rules**: Theme-aware via CSS variables
- **Links**: Underlined, with offset, theme-aware color

## Body Structure

### Main Container and Header

```html
<body>
    <div class="conversation">
        <div class="conversation-header">
            <div>
                <button class="toggle">
                    <svg class="sun"><!-- sun icon --></svg>
                    <svg class="moon"><!-- moon icon --></svg>
                </button>
                <button class="toggle width-toggle">
                    <svg class="expand"><!-- expand icon --></svg>
                    <svg class="narrow"><!-- narrow icon --></svg>
                </button>
            </div>
            <div class="conversation-export">
                <!-- SVG definitions for icons -->
            </div>
        </div>
```

**Key observations:**

- Everything wrapped in `<div class="conversation">`
- Header contains theme toggle and width toggle buttons
- SVG icons inline, toggle visibility via CSS
- Icon definitions stored in conversation-export section

### Metadata Section

```html
<div class="metadata_container">
    <div class="metadata_item"><div>title</div><div>Freezing Rye Bread</div></div>
    <div class="metadata_item"><div>source</div><div>https://chatgpt.com/c/6873cd0d-3740-8010-b874-bf6d04968295</div></div>
    <!-- Additional metadata items as needed -->
</div>
```

**Key observations:**

- Two-column layout: label and value
- Title and source URL included
- Styled with hover effects
- Label uses distinct color (`--meta-title`)

### Message Structure

```html
<div class="conversation-item">
    <div class="author user">
        <svg width="41" height="41"><use xlink:href="#user" /></svg>
    </div>
    <div class="conversation-content-wrapper">
        <div class="conversation-content">
            <p class="no-katex">can this be frozen</p>
        </div>
    </div>
</div>

<div class="conversation-item">
    <div class="author GPT-3">
        <svg width="41" height="41"><use xlink:href="#chatgpt" /></svg>
    </div>
    <div class="conversation-content-wrapper">
        <div class="conversation-content">
            <p>Yes, <strong>rye bread can be frozen</strong> successfully...</p>
            <!-- Rich HTML content: headings, lists, bold, etc. -->
        </div>
    </div>
</div>
```

**Key observations:**

- Each message is a `conversation-item`
- Author section contains SVG icon (references defined in header)
- Author class varies: `"author user"` or `"author GPT-3"` (or GPT-4, etc.)
- Content nested in `conversation-content-wrapper` > `conversation-content`
- Content is rendered HTML (not escaped text)
- Paragraphs use `class="no-katex"` for user messages to prevent math rendering

### Content Rendering

From examples in the file:

- **Paragraphs**: Standard `<p>` tags
- **Bold**: `<strong>` tags
- **Lists**: Standard `<ul>`, `<ol>`, `<li>`
- **Headings**: `<h1>` through `<h6>`
- **Horizontal rules**: `<hr>`
- **Code blocks**: `<pre><code>` structure
- **Emoji**: Rendered directly in text (ðŸ”¥, ðŸ¥‡, etc.)

### Footer Scripts

```html
<script>
    function toggleDarkMode(mode) {
        // Theme switching logic
    }
    function toggleWidthMode(mode) {
        // Width switching logic
    }
    // URL parameter reading for initial state
    // Event listeners
</script>
</body>
</html>
```

**Key observations:**

- Interactive theme/width toggling
- State persisted in URL query parameters
- No external JavaScript dependencies for core functionality

## CSS Classes Reference

### Container Classes

- `conversation` - main wrapper
- `conversation-header` - header with controls
- `conversation-export` - SVG definitions container
- `conversation-item` - individual message wrapper
- `conversation-content-wrapper` - content container
- `conversation-content` - actual message content

### Metadata Classes

- `metadata_container` - metadata wrapper
- `metadata_item` - individual metadata row

### Author Classes

- `author` - base author class
- `author user` - user messages
- `author GPT-3` - assistant messages (model name varies)

### Utility Classes

- `toggle` - button styling
- `width-toggle` - width toggle button
- `sun`, `moon` - theme icons
- `expand`, `narrow` - width icons
- `no-katex` - prevents math rendering

## Key Differences from Current Implementation

Comparing with `/Users/acolomba/src/chatgpt2applenotes/.worktrees/implement-chatgpt2applenotes/chatgpt2applenotes/exporters/html.py`:

### 1. HTML Structure

- **Current**: Simple `<div class="message">` with `<div class="author">` and `<div class="content">`
- **Reference**: `<div class="conversation-item">` with nested structure and SVG icons

### 2. Styling

- **Current**: No CSS at all
- **Reference**: Extensive embedded CSS (400+ lines) with:
  - CSS custom properties for theming
  - Light/dark mode support
  - Complete typography system
  - Code highlighting styles
  - Table, list, blockquote styles
  - Scrollbar customization

### 3. Head Section

- **Current**: Minimal (charset and title only)
- **Reference**: Full meta tags, external library links (Highlight.js, KaTeX), embedded JavaScript

### 4. Content Processing

- **Current**: HTML-escapes all content, wraps in `<p>` tags
- **Reference**: Renders markdown to HTML, preserves rich formatting

### 5. Theme Support

- **Current**: None
- **Reference**: Light/dark mode with toggle buttons and URL persistence

### 6. Interactive Features

- **Current**: None
- **Reference**: Theme toggle, width toggle, math rendering, code highlighting

### 7. Metadata Display

- **Current**: None (only title as h1)
- **Reference**: Structured metadata section with title, source URL

### 8. Author Representation

- **Current**: Text label (capitalized role)
- **Reference**: SVG icons with author class indicating role

### 9. Message Content

- **Current**: Single string, escaped
- **Reference**: Rich HTML with paragraphs, headings, lists, code blocks, etc.

## Implementation Priorities for Task 9

Based on this analysis, Task 9 should focus on:

1. **CSS Integration**: Embed complete CSS from reference (largest visual difference)
2. **HTML Structure**: Update to use `conversation-item`, `conversation-content-wrapper`, etc.
3. **SVG Icons**: Add SVG definitions and icon references for authors
4. **Head Section**: Add meta tags, library links, JavaScript
5. **Markdown Rendering**: Use existing markdown renderer to generate rich content HTML
6. **Theme Support**: Add data-theme attribute and toggle buttons
7. **Metadata Section**: Add structured metadata display
8. **Content Formatting**: Remove HTML escaping, use rendered markdown

## CSS Size Estimate

The CSS section spans approximately lines 63-558 in the reference file (495 lines of CSS), including:

- Variables and theming
- Reset and base styles
- Typography
- Components (buttons, metadata, messages)
- Scrollbars
- Responsive design

## External Dependencies

Required for full feature parity:

1. **Highlight.js** v11.7.0 - code syntax highlighting
2. **KaTeX** v0.16.3 - mathematical notation rendering
3. CDN links already specified in reference

## Notes

- The reference uses semantic HTML with accessibility in mind
- SVG icons are defined once and referenced via `xlink:href`
- All interactive features gracefully degrade without JavaScript
- CSS is self-contained (no external stylesheets except libraries)
- Design follows OpenAI's ChatGPT web interface aesthetics
